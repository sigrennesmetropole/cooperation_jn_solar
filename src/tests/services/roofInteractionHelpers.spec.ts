import {
  filterGrid,
  generateRectangleGrid,
  Matrix,
} from '@/services/roofInteractionHelper'
import { describe, it, expect } from 'vitest'
import type { BBox2d } from '@turf/helpers/dist/js/lib/geojson'
import type { GeoJSONFeatureCollection } from 'ol/format/GeoJSON'
import type { Grid } from '@/helpers/rectangleGrid'

describe('generateRectangleGrid', () => {
  it('should return a valid grid object', () => {
    const roofShape = null
    const roofSlope = 0
    const bboxOnRoof: BBox2d = [-1.6815, 48.1167, -1.6813, 48.1168]
    const rectangleWidth = 500
    const rectangleHeight = 1000
    const roofAzimuth = 45

    const grid = generateRectangleGrid(
      roofShape!,
      roofSlope,
      bboxOnRoof!,
      rectangleWidth!,
      rectangleHeight!,
      roofAzimuth
    )

    expect(grid).toBeDefined()
    expect(grid.rows).toBe(11)
    expect(grid.columns).toBe(29)
    expect(grid.featureCollection).toBeDefined()
    expect(grid.featureCollection.features.length).toBe(11 * 29)
  })
  it('should return an object even with a grid too small to generate rectangles', () => {
    const roofShape = null
    const roofSlope = 0
    const bboxOnRoof: BBox2d = [-1.6815, 48.11675, -1.68145, 48.1168]
    const rectangleWidth = 5000
    const rectangleHeight = 5000
    const roofAzimuth = 45

    const grid = generateRectangleGrid(
      roofShape!,
      roofSlope,
      bboxOnRoof!,
      rectangleWidth!,
      rectangleHeight!,
      roofAzimuth
    )

    expect(grid).toBeDefined()
    expect(grid.rows).toBe(1)
    expect(grid.columns).toBe(0)
    expect(grid.featureCollection).toBeDefined()
    expect(grid.featureCollection.features.length).toBe(0)
  })
})

describe('filterGrid', () => {
  const initRoofShape: GeoJSONFeatureCollection = {
    type: 'FeatureCollection',
    features: [
      {
        type: 'Feature',
        id: 'coopterr_solaire_toits.354461',
        geometry: {
          type: 'Polygon',
          coordinates: [
            [
              [-1.650766, 48.093467],
              [-1.650768, 48.093506],
              [-1.650493, 48.093511],
              [-1.650491, 48.093473],
              [-1.650766, 48.093467],
            ],
          ],
        },
        properties: {
          id: 354461,
          emprise_id: null,
          emprise_id_rm: '35238_030686',
          zmax: 62.28,
          maj_date: '2018-08-28',
          maj_auteur: 's.andru',
        },
        bbox: [-1.650768, 48.093467, -1.650491, 48.093511],
      },
    ],
    bbox: [-1.650768, 48.093467, -1.650491, 48.093511],
  }
  const initGrid: Grid = {
    rows: 53,
    columns: 16,
    featureCollection: {
      type: 'FeatureCollection',
      features: [
        {
          type: 'Feature',
          id: '3:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505149890982693, 48.093500111405504],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505024614539252, 48.093503273850786],
                [-1.6505019578733027, 48.09349547618655],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505280202347876, 48.093502537463785],
                [-1.6505024614539252, 48.093503273850786],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '3:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.65051448552083, 48.093492313741294],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505019578733027, 48.09349547618655],
                [-1.650501454302571, 48.093487678522315],
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505019578733027, 48.09349547618655],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '3:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505139819348642, 48.09348451607708],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650501454302571, 48.093487678522315],
                [-1.6505009507136492, 48.093479880858084],
                [-1.6505265094830293, 48.09347914447124],
                [-1.6505270130676308, 48.093486942135435],
                [-1.650501454302571, 48.093487678522315],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505405478773127, 48.09349937501852],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505280202347876, 48.093502537463785],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505535790155363, 48.09350180107676],
                [-1.6505280202347876, 48.093502537463785],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505400442917448, 48.09349157735437],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505275166506408, 48.0934947397996],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505395407059495, 48.09348377969022],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505265094830293, 48.09347914447124],
                [-1.6505520682517272, 48.09347840808442],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505270130676308, 48.093486942135435],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505661066558446, 48.09349863863153],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505535790155363, 48.09350180107676],
                [-1.6505530754274105, 48.09349400341266],
                [-1.650578634203839, 48.0934932670257],
                [-1.6505791377958303, 48.093501064689775],
                [-1.6505535790155363, 48.09350180107676],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505656030663545, 48.09349084096745],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505781306123026, 48.093485469361646],
                [-1.650578634203839, 48.0934932670257],
                [-1.6505530754274105, 48.09349400341266],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650565099476239, 48.09348304330335],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505520682517272, 48.09347840808442],
                [-1.6505776270203114, 48.09347767169757],
                [-1.6505781306123026, 48.093485469361646],
                [-1.6505525718404215, 48.093486205748526],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505916654339785, 48.09349790224456],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505791377958303, 48.093501064689775],
                [-1.650578634203839, 48.0934932670257],
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506046965756695, 48.09350032830276],
                [-1.6505791377958303, 48.093501064689775],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505911618402251, 48.093490104580525],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650578634203839, 48.0934932670257],
                [-1.6505781306123026, 48.093485469361646],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6506041929796993, 48.09349253063874],
                [-1.650578634203839, 48.0934932670257],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505906582464718, 48.093482306916485],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505781306123026, 48.093485469361646],
                [-1.6505776270203114, 48.09347767169757],
                [-1.650603185788441, 48.093476935310726],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6505781306123026, 48.093485469361646],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506172242116577, 48.09349716585758],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506046965756695, 48.09350032830276],
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506046965756695, 48.09350032830276],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650616720614039, 48.093489368193595],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506041929796993, 48.09349253063874],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506162170163634, 48.09348157052962],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506036893841838, 48.093484732974744],
                [-1.650603185788441, 48.093476935310726],
                [-1.6506287445562293, 48.09347619892391],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506036893841838, 48.093484732974744],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650643286590821, 48.09350422713452],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506307589550033, 48.09350738957969],
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506563177380258, 48.093506653192634],
                [-1.6506307589550033, 48.09350738957969],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506427829891095, 48.093496429470605],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506302553551677, 48.09349959191575],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506422793875686, 48.09348863180668],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506297517554458, 48.0934917942518],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650641775785914, 48.09348083414275],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506287445562293, 48.09347619892391],
                [-1.6506543033237904, 48.09347546253705],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506292481558376, 48.09348399658784],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506688453716833, 48.09350349074748],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506563177380258, 48.093506653192634],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506818765205935, 48.09350591680558],
                [-1.6506563177380258, 48.093506653192634],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506683417662202, 48.09349569308361],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506558141343248, 48.09349885552874],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650667838160814, 48.093487895419756],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506553105308512, 48.093491057864846],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506673345551235, 48.09348009775589],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506543033237904, 48.09347546253705],
                [-1.650679862090783, 48.09347472615022],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6506548069271503, 48.09348326020096],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506944041522615, 48.09350275436045],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506818765205935, 48.09350591680558],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6507069316915022, 48.09349738275472],
                [-1.6507074353029338, 48.09350518041851],
                [-1.6506818765205935, 48.09350591680558],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.65069390054299, 48.09349495669664],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507069316915022, 48.09349738275472],
                [-1.6506813729131409, 48.093498119141735],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650693396933491, 48.093487159032826],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6507059244686388, 48.09348178742716],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6506808693060293, 48.09349032147789],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650692893323935, 48.09347936136902],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506803656980082, 48.09348252381406],
                [-1.650679862090783, 48.09347472615022],
                [-1.6507054208575482, 48.093473989763375],
                [-1.6507059244686388, 48.09348178742716],
                [-1.6506803656980082, 48.09348252381406],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650719962932385, 48.093502017973414],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507074353029338, 48.09350518041851],
                [-1.6507069316915022, 48.09349738275472],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507329940848194, 48.093504444031446],
                [-1.6507074353029338, 48.09350518041851],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507194593193049, 48.09349422030966],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507069316915022, 48.09349738275472],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507319868550212, 48.093488848704],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507069316915022, 48.09349738275472],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507189557060542, 48.09348642264591],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507059244686388, 48.09348178742716],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507319868550212, 48.093488848704],
                [-1.6507064280805253, 48.09348958509094],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507184520925193, 48.093478624982154],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507059244686388, 48.09348178742716],
                [-1.6507054208575482, 48.093473989763375],
                [-1.6507309796239724, 48.09347325337654],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507059244686388, 48.09348178742716],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650745521712281, 48.09350128158638],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507329940848194, 48.093504444031446],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507580492472016, 48.0934959099807],
                [-1.6507585528664777, 48.09350370764437],
                [-1.6507329940848194, 48.093504444031446],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507450180953356, 48.093493483922686],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650732490469636, 48.09349664636773],
                [-1.6507319868550212, 48.093488848704],
                [-1.6507575456319046, 48.09348811231703],
                [-1.6507580492472016, 48.0934959099807],
                [-1.650732490469636, 48.09349664636773],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507445144796975, 48.09348568625899],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507319868550212, 48.093488848704],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507570420086495, 48.09348031465339],
                [-1.6507575456319046, 48.09348811231703],
                [-1.6507319868550212, 48.093488848704],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507440108605351, 48.09347788859529],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650731483239042, 48.09348105104027],
                [-1.6507309796239724, 48.09347325337654],
                [-1.6507565383898282, 48.0934725169897],
                [-1.6507570420086495, 48.09348031465339],
                [-1.650731483239042, 48.09348105104027],
              ],
            ],
          },
        },
      ],
    },
  }
  const resGrid: Grid = {
    rows: 53,
    columns: 16,
    featureCollection: {
      type: 'FeatureCollection',
      features: [
        {
          type: 'Feature',
          id: '3:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505149890982693, 48.093500111405504],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505024614539252, 48.093503273850786],
                [-1.6505019578733027, 48.09349547618655],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505280202347876, 48.093502537463785],
                [-1.6505024614539252, 48.093503273850786],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '3:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.65051448552083, 48.093492313741294],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505019578733027, 48.09349547618655],
                [-1.650501454302571, 48.093487678522315],
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505019578733027, 48.09349547618655],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '3:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505139819348642, 48.09348451607708],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650501454302571, 48.093487678522315],
                [-1.6505009507136492, 48.093479880858084],
                [-1.6505265094830293, 48.09347914447124],
                [-1.6505270130676308, 48.093486942135435],
                [-1.650501454302571, 48.093487678522315],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505405478773127, 48.09349937501852],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505280202347876, 48.093502537463785],
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505535790155363, 48.09350180107676],
                [-1.6505280202347876, 48.093502537463785],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505400442917448, 48.09349157735437],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505275166506408, 48.0934947397996],
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505275166506408, 48.0934947397996],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '4:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505395407059495, 48.09348377969022],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505270130676308, 48.093486942135435],
                [-1.6505265094830293, 48.09347914447124],
                [-1.6505520682517272, 48.09347840808442],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505270130676308, 48.093486942135435],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505661066558446, 48.09349863863153],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505535790155363, 48.09350180107676],
                [-1.6505530754274105, 48.09349400341266],
                [-1.650578634203839, 48.0934932670257],
                [-1.6505791377958303, 48.093501064689775],
                [-1.6505535790155363, 48.09350180107676],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505656030663545, 48.09349084096745],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505530754274105, 48.09349400341266],
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505781306123026, 48.093485469361646],
                [-1.650578634203839, 48.0934932670257],
                [-1.6505530754274105, 48.09349400341266],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '5:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650565099476239, 48.09348304330335],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505525718404215, 48.093486205748526],
                [-1.6505520682517272, 48.09347840808442],
                [-1.6505776270203114, 48.09347767169757],
                [-1.6505781306123026, 48.093485469361646],
                [-1.6505525718404215, 48.093486205748526],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505916654339785, 48.09349790224456],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505791377958303, 48.093501064689775],
                [-1.650578634203839, 48.0934932670257],
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506046965756695, 48.09350032830276],
                [-1.6505791377958303, 48.093501064689775],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505911618402251, 48.093490104580525],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650578634203839, 48.0934932670257],
                [-1.6505781306123026, 48.093485469361646],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6506041929796993, 48.09349253063874],
                [-1.650578634203839, 48.0934932670257],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '6:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6505906582464718, 48.093482306916485],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6505781306123026, 48.093485469361646],
                [-1.6505776270203114, 48.09347767169757],
                [-1.650603185788441, 48.093476935310726],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6505781306123026, 48.093485469361646],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506172242116577, 48.09349716585758],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506046965756695, 48.09350032830276],
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506046965756695, 48.09350032830276],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650616720614039, 48.093489368193595],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506041929796993, 48.09349253063874],
                [-1.6506036893841838, 48.093484732974744],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506041929796993, 48.09349253063874],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '7:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506162170163634, 48.09348157052962],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506036893841838, 48.093484732974744],
                [-1.650603185788441, 48.093476935310726],
                [-1.6506287445562293, 48.09347619892391],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506036893841838, 48.093484732974744],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650643286590821, 48.09350422713452],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506307589550033, 48.09350738957969],
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506563177380258, 48.093506653192634],
                [-1.6506307589550033, 48.09350738957969],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506427829891095, 48.093496429470605],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506302553551677, 48.09349959191575],
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506302553551677, 48.09349959191575],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506422793875686, 48.09348863180668],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506297517554458, 48.0934917942518],
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506297517554458, 48.0934917942518],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '8:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650641775785914, 48.09348083414275],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506292481558376, 48.09348399658784],
                [-1.6506287445562293, 48.09347619892391],
                [-1.6506543033237904, 48.09347546253705],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506292481558376, 48.09348399658784],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506688453716833, 48.09350349074748],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506563177380258, 48.093506653192634],
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506818765205935, 48.09350591680558],
                [-1.6506563177380258, 48.093506653192634],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506683417662202, 48.09349569308361],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506558141343248, 48.09349885552874],
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506558141343248, 48.09349885552874],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650667838160814, 48.093487895419756],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506553105308512, 48.093491057864846],
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506553105308512, 48.093491057864846],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '9:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506673345551235, 48.09348009775589],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506548069271503, 48.09348326020096],
                [-1.6506543033237904, 48.09347546253705],
                [-1.650679862090783, 48.09347472615022],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6506548069271503, 48.09348326020096],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6506944041522615, 48.09350275436045],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506818765205935, 48.09350591680558],
                [-1.6506813729131409, 48.093498119141735],
                [-1.6507069316915022, 48.09349738275472],
                [-1.6507074353029338, 48.09350518041851],
                [-1.6506818765205935, 48.09350591680558],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.65069390054299, 48.09349495669664],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506813729131409, 48.093498119141735],
                [-1.6506808693060293, 48.09349032147789],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507069316915022, 48.09349738275472],
                [-1.6506813729131409, 48.093498119141735],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650693396933491, 48.093487159032826],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506808693060293, 48.09349032147789],
                [-1.6506803656980082, 48.09348252381406],
                [-1.6507059244686388, 48.09348178742716],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6506808693060293, 48.09349032147789],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '10:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650692893323935, 48.09347936136902],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6506803656980082, 48.09348252381406],
                [-1.650679862090783, 48.09347472615022],
                [-1.6507054208575482, 48.093473989763375],
                [-1.6507059244686388, 48.09348178742716],
                [-1.6506803656980082, 48.09348252381406],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650719962932385, 48.093502017973414],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507074353029338, 48.09350518041851],
                [-1.6507069316915022, 48.09349738275472],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507329940848194, 48.093504444031446],
                [-1.6507074353029338, 48.09350518041851],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507194593193049, 48.09349422030966],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507069316915022, 48.09349738275472],
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507319868550212, 48.093488848704],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507069316915022, 48.09349738275472],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507189557060542, 48.09348642264591],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507064280805253, 48.09348958509094],
                [-1.6507059244686388, 48.09348178742716],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507319868550212, 48.093488848704],
                [-1.6507064280805253, 48.09348958509094],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '11:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507184520925193, 48.093478624982154],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507059244686388, 48.09348178742716],
                [-1.6507054208575482, 48.093473989763375],
                [-1.6507309796239724, 48.09347325337654],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507059244686388, 48.09348178742716],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:24',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.650745521712281, 48.09350128158638],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507329940848194, 48.093504444031446],
                [-1.650732490469636, 48.09349664636773],
                [-1.6507580492472016, 48.0934959099807],
                [-1.6507585528664777, 48.09350370764437],
                [-1.6507329940848194, 48.093504444031446],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:25',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507450180953356, 48.093493483922686],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650732490469636, 48.09349664636773],
                [-1.6507319868550212, 48.093488848704],
                [-1.6507575456319046, 48.09348811231703],
                [-1.6507580492472016, 48.0934959099807],
                [-1.650732490469636, 48.09349664636773],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:26',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507445144796975, 48.09348568625899],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.6507319868550212, 48.093488848704],
                [-1.650731483239042, 48.09348105104027],
                [-1.6507570420086495, 48.09348031465339],
                [-1.6507575456319046, 48.09348811231703],
                [-1.6507319868550212, 48.093488848704],
              ],
            ],
          },
        },
        {
          type: 'Feature',
          id: '12:27',
          properties: {
            center: {
              type: 'Point',
              coordinates: [-1.6507440108605351, 48.09347788859529],
            },
          },
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [-1.650731483239042, 48.09348105104027],
                [-1.6507309796239724, 48.09347325337654],
                [-1.6507565383898282, 48.0934725169897],
                [-1.6507570420086495, 48.09348031465339],
                [-1.650731483239042, 48.09348105104027],
              ],
            ],
          },
        },
      ],
    },
  }
  const usablesIds: Matrix = [
    {
      id: '3:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505149890540451, 48.0934990068252],
      },
    },
    {
      id: '3:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505144854766058, 48.09349120916099],
      },
    },
    {
      id: '3:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.65051398189064, 48.09348341149678],
      },
    },
    {
      id: '4:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505405478330886, 48.09349827043822],
      },
    },
    {
      id: '4:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505400442475207, 48.093490472774064],
      },
    },
    {
      id: '4:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505395406617254, 48.093482675109925],
      },
    },
    {
      id: '5:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505661066116204, 48.09349753405123],
      },
    },
    {
      id: '5:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505656030221303, 48.093489736387156],
      },
    },
    {
      id: '5:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.650565099432015, 48.093481938723045],
      },
    },
    {
      id: '6:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505916653897543, 48.09349679766426],
      },
    },
    {
      id: '6:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.650591161796001, 48.09348900000022],
      },
    },
    {
      id: '6:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6505906582022476, 48.093481202336186],
      },
    },
    {
      id: '7:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506172241674335, 48.09349606127728],
      },
    },
    {
      id: '7:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506167205698148, 48.093488263613295],
      },
    },
    {
      id: '7:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506162169721392, 48.09348046594933],
      },
    },
    {
      id: '8:24',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506432865465968, 48.09350312255422],
      },
    },
    {
      id: '8:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506427829448853, 48.0934953248903],
      },
    },
    {
      id: '8:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506422793433444, 48.09348752722638],
      },
    },
    {
      id: '8:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506417757416898, 48.093479729562446],
      },
    },
    {
      id: '9:24',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506688453274592, 48.09350238616719],
      },
    },
    {
      id: '9:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.650668341721996, 48.09349458850332],
      },
    },
    {
      id: '9:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506678381165898, 48.09348679083945],
      },
    },
    {
      id: '9:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506673345108993, 48.093478993175594],
      },
    },
    {
      id: '10:24',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506944041080374, 48.09350164978015],
      },
    },
    {
      id: '10:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506939004987657, 48.09349385211634],
      },
    },
    {
      id: '10:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6506933968892668, 48.093486054452526],
      },
    },
    {
      id: '10:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.650692893279711, 48.093478256788714],
      },
    },
    {
      id: '11:24',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507199628881608, 48.09350091339312],
      },
    },
    {
      id: '11:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507194592750807, 48.09349311572936],
      },
    },
    {
      id: '11:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.65071895566183, 48.0934853180656],
      },
    },
    {
      id: '11:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507184520482951, 48.09347752040185],
      },
    },
    {
      id: '12:24',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507455216680569, 48.09350017700608],
      },
    },
    {
      id: '12:25',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507450180511114, 48.09349237934238],
      },
    },
    {
      id: '12:26',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.6507445144354733, 48.093484581678695],
      },
    },
    {
      id: '12:27',
      squareCenter: {
        type: 'Point',
        coordinates: [-1.650744010816311, 48.09347678401498],
      },
    },
  ]
  it('should filter realistic grid', () => {
    const roofShape = initRoofShape
    const grid = initGrid

    const filteredGrid = filterGrid(roofShape!, grid!)

    expect(filteredGrid).toBeDefined()

    expect(filteredGrid.grid).toBeDefined()
    expect(filteredGrid.grid).toStrictEqual(resGrid)

    expect(filteredGrid.usableIds).toBeDefined()
    expect(filteredGrid.usableIds).toStrictEqual(usablesIds)
  })
})
